define(function(a){function b(a){function b(){a.fetchLogo(function(a){a&&i.ractive.set("logo",a)})}function e(){var b=a.mainDocument.querySelector("#_"+a.uuid);b.classList.contains("minimized")?f():g()}function f(){var c=a.mainDocument.querySelector("#_"+a.uuid);c.classList.remove("cb-remove-transitions"),i.ractive.set("isMinimized",!1),n.setPluginUIState(a,d.CHAT_STATES.maximised,!0),c.classList.remove("minimized"),c.classList.add("maximized"),b(),window.parent.innerWidth<d.MOBILE_WIDTH_THRESHOLD&&!c.classList.contains("minimized")&&l.toggleMobileView(i,a,!0)}function g(){var b=a.mainDocument.querySelector("#_"+a.uuid);i.ractive.set("isMinimized",!0),n.setPluginUIState(a,d.CHAT_STATES.minimised,!0),b.classList.remove("maximized"),b.classList.add("minimized"),l.toggleMobileView(i,a,!1)}function h(){const b=a.mainDocument.getElementById("_"+a.uuid),c=n.isMobileView(),d={desktopType:i.ractive.get("desktopType"),mobileType:i.ractive.get("mobileType")};l.toggleMobileView(i,a,c&&!b.classList.contains("minimized")),m.switchToMobile(b,d,c)}var i=this,j=!1,k=a.getService("cb_markdown"),l=a.getService("cb_utils"),m=a.getService("cb_button_switch"),n=a.getService("cb_visitor_utils"),o=d.STR_CWP_POSITION+a.getBusinesscaseId(),p=d.STR_CWP_MINIMIZE_DESKTOP_TYPE+a.getBusinesscaseId(),q=d.STR_CWP_MINIMIZE_MOBILE_TYPE+a.getBusinesscaseId();i.text=l.addTargetBlankAttr(k.toHTML(a.getField("pcrt_editor"))),i.color=a.getField("color"),i.title=a.getField("bc_chat_title"),i.buttonText=a.getField("pcrt_ok_button"),i.enable=a.getField("pcrt_enable"),i.display_always="always"===a.getField("pcrt_display"),i.startChat=function(){i.agent=null,a.setData("PreChatClicked","Clicked"),a.publishEvent("terms_accepted",{accept_url:a.getClientUrl()}),a.setDone()},i.render=function(){i.isRendered||(i.isRendered=!0,a.render(function(k){var l=document.createElement("div"),m=a.mainDocument.querySelector("#_"+a.uuid),r=n.isPluginUIStateMinimized(a.uuid),s=c.browserStorage.get(o)||d.STR_CWP_POSITION_DEFAULT,t=c.browserStorage.get(p)||d.CHAT_BUTTON_TYPES.BAR,u=c.browserStorage.get(q)||d.CHAT_BUTTON_TYPES.BUBBLE;m.classList.add(s),k.appendChild(l),i.ractive=new Ractive({el:l,template:a.getCompiledTemplate("pre_chat_rich_text"),data:{color:i.color,headerColor:window.tinycolor(i.color).isLight()?" dark":" light",title:i.title,text:i.text,theme:a.getTheme(),isMinimized:r,buttonText:i.buttonText,desktopType:t,mobileType:u,position:s,trans:a.translate}}),r?(m.classList.add("cb-remove-transitions"),g(m)):f(m),i.ractive.on("start_chat",function(a){return i.display_always||c.browserStorage.set("preChatDisplayed",!0),i.startChat(),a&&a.original.preventDefault&&a.original.preventDefault(),!1}),i.ractive.on("closeChat",function(b){var d=!0;return b&&b.original.preventDefault&&b.original.preventDefault(),a.end(d),a.setData("declinedChat",!0),c.browserStorage.set("start_message_internal",null),!1}),i.ractive.on("toggleOptionsMenu",function(){var b=a.mainDocument.querySelector("#_"+a.uuid);b.classList.contains("minimized")&&e(),j=!j,i.ractive.set("isOptionsMenuShown",j)}),i.ractive.on("toggleChatWindow",function(a){return e(),a&&a.original.preventDefault&&a.original.preventDefault(),!1}),c.browserStorage.bind("kernel.pluginUIStates",function(){if(i.isRendered){var b=n.isPluginMatchState(a.getPluginState(),a.getBusinesscaseId()),c=n.isPluginUIStateMaximized(a.uuid),d=n.isPluginUIStateMinimized(a.uuid);b&&c&&i.ractive.get("isMinimized")?f():d&&!i.ractive.get("isMinimized")&&g()}}),window.parent.addEventListener("resize",h);var v;"function"==typeof Event?v=new Event("resize"):(v=document.createEvent("Event"),v.initEvent("resize",!0,!0)),window.parent.dispatchEvent(v),b()}))},i.start=function(){var b=a.getData("chatHasStarted"),d=c.browserStorage.get("preChatDisplayed");i.enable&&(i.display_always||!b&&!d)?i.render():a.setDone()},i.stop=function(){i.isRendered&&(window.parent.removeEventListener("resize",h),l.toggleMobileView(i,a,!1),a.remove(),i.isRendered=!1)}}var c=a("sdk/cobrowser"),d=a("sdk/config");window.registerPlugin({type:"info",context:"visitor",name:"pre_chat_rich_text",scope:b,handlers:[{name:"start",execute:function(){this.start()}},{name:"stop",execute:function(){this.stop()}}]})});
//# sourceMappingURL=pre_chat_rich_text.js.map